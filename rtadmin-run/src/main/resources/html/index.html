<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>昆明经开区网格化管理服务组织架构</title>
    <link rel="stylesheet" type="text/css" href="component/bootstrap-3.3.7-dist/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="component/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="src/css/links.css">
    <script type="text/javascript" src="component/jquery-1.10.2.min.js"></script>
    <script type="text/javascript" src="component/bootstrap-3.3.7-dist/js/bootstrap.js"></script>
    <script type="text/javascript" src="static/js/jquery.ajax.js"></script>
    <script type="text/javascript" src="static/js/template-web.js"></script>
    <script type="text/javascript" src="component/socket/socketServer.js"></script>
</head>
<body>
<div id="wrapper">
    <div id="header"></div>
    <script id="tpl-header" type="text/html">
        <h1></h1>
        <p class="txtP">{{title}}</p>
    </script>

    <div id="container" class="clearfix posT">
        <span class="arrowMid01"></span>
        <div class="orgLeft" id="orgBoxLeft">
            <script id="tpl-orgBoxLeft" type="text/html">
            <div class="orgLeftIn">
                <h2 class="ttl01">区疫情防控指挥长</h2>
                <div class="leftBox01">
                    <span class="bgTop01"></span>
                    <span class="bgTop02"></span>
                    <span class="bgBtm01"></span>
                    <span class="bgBtm02"></span>
                    <div class="leftBox01In">
                        <!--<span>赵学峰</span>
                        <span>李河流</span>-->
                        {{each zhbzhzList item i}}
                            <span> {{item}} </span>
                        {{/each}}

                    </div>
                </div>
                <div class="leftArrow01"></div>
                <h2 class="ttl01">区疫情防控指挥部副指挥长</h2>
                <div class="leftBox01">
                    <span class="bgTop01"></span>
                    <span class="bgTop02"></span>
                    <span class="bgBtm01"></span>
                    <span class="bgBtm02"></span>
                    <div class="leftBox01In tmore clearfix">
                        <!--<span>何云虹</span>
                        <span>王月冲</span>
                        <span>王桂泽</span>
                        <span>徐春</span>
                        <span>李勇</span>
                        <span>金平</span>
                        <span>戴瑞</span>
                        <span>王刚</span>
                        <span>王勇</span>-->
                        {{each zhbfzhzList item i}}
                        <span> {{item}} </span>
                        {{/each}}

                    </div>
                </div>
                <div class="leftArrow01"></div>
                <h2 class="ttlR">区疫情防控指挥部</h2>
            </div>
            </script>
        </div>
        <div class="orgRight">
            <div class="orgRightIn">
                <div class="orgCon">
                    <!--box1-->
                    <div class="orgBox01 clearfix bluePart" id="orgBox01"></div>
                    <script id="tpl-orgBox01" type="text/html">
                        <div class="orgConLft" onclick="jgOnclick('{{jgid}}','{{jgmc}}','{{jglx}}','{{jgOrHy}}')">
                            <a href="#">
                                <h3 class="ttl02">{{jgmc}}</h3>
                                <div class="ttlBox">
                                    <span>{{wgz}}</span><!--<span>赵赵赵3</span>-->
                                </div>
                            </a>
                        </div>
                        <div class="orgConMid">
                            <ul class="orgList01">
                                {{each children item i}}
                                <li onclick="jgOnclick('{{item.jgid}}','{{item.jgmc}}','{{item.jglx}}','{{item.jgOrHy}}')">
                                    <a href="#">
                                        <h4 class="ttl03">{{item.jgmc}}</h4>
                                        <div class="ttlBox01">
                                            <span>{{item.wgz}}</span><!--<span>赵赵赵5</span><span>赵赵赵6</span>-->
                                        </div>
                                    </a>
                                </li>
                                {{/each}}
                            </ul>
                        </div>
                        <div class="orgConRgt">
                            <h3 class="ttl04">居民小组或居民小区</h3>
                            <p class="orgTxt01">网格长：党支部书记和小组长；<br/>物业公司主要负责人或社区工作人员；楼栋长、单元长</p>
                        </div>
                    </script>
                    <!--box1 //-->
                    <!--box2-->
                    <div class="orgBox01 clearfix yellowPart" id="orgBox02"></div>
                    <script id="tpl-orgBox02" type="text/html">
                        <div class="orgConLft" onclick="jgOnclick('{{jgid}}','{{jgmc}}','{{jglx}}','{{jgOrHy}}')">
                            <a href="#">
                                <h3 class="ttl02">{{jgmc}}</h3>
                                <div class="ttlBox">
                                    <span>{{wgz}}</span><!--<span>赵赵赵</span>-->
                                </div>
                            </a>
                        </div>
                        <div class="orgConMid">
                            <ul class="orgList01">
                                {{each children item i}}
                                <li onclick="jgOnclick('{{item.jgid}}','{{item.jgmc}}','{{item.jglx}}','{{item.jgOrHy}}')">
                                    <a href="#">
                                        <h4 class="ttl03">{{item.jgmc}}</h4>
                                        <div class="ttlBox01">
                                            <span>{{item.wgz}}</span><!--<span>赵赵赵</span><span>赵赵赵</span>-->
                                        </div>
                                    </a>
                                </li>
                                {{/each}}
                            </ul>
                        </div>
                        <div class="orgConRgt">
                            <h3 class="ttl04">居民小组或居民小区</h3>
                            <p class="orgTxt01">网格长：党支部书记和小组长；<br/>物业公司主要负责人或社区工作人员；楼栋长、单元长</p>
                        </div>
                    </script>
                    <!--box2 //-->
                    <!--box3-->
                    <div class="orgBox01 clearfix greenPart" id="orgBox03"></div>
                    <script id="tpl-orgBox03" type="text/html">
                        <div class="orgConLft">

                            <h3 class="ttl02">{{jgmc}}</h3>
                            <div class="ttlBox">
                                <span>{{wgz}}</span>
                            </div>

                        </div>
                        <div class="orgConMid">
                            <ul class="orgList01">
                                {{each children item i}}
                                <li onclick="jgOnclick('{{item.jgid}}','{{item.jgmc}}','{{item.jglx}}','{{item.jgOrHy}}')">
                                    <h4 class="ttl03">{{item.jgmc}}</h4>
                                    <div class="ttlBox01">
                                        <span>{{item.wgz}}</span><!--<span>赵赵赵</span><span>赵赵赵</span>-->
                                    </div>
                                </li>
                                {{/each}}
                            </ul>
                        </div>
                        <div class="orgConRgt">
                            <h3 class="ttl04">居民小组或居民小区</h3>
                            <p class="orgTxt01">网格长：党支部书记和小组长；<br/>物业公司主要负责人或社区工作人员；楼栋长、单元长</p>
                        </div>
                    </script>
                    <!--box3 //-->
                </div>
            </div>
        </div>
    </div>

</div>


<script>

    var initTitle = function () {
        var html = template('tpl-header', {title: '云南省自贸区昆明片区（昆明经开区）疫情防控网格化管理工作图'});
        document.getElementById('header').innerHTML = html;
    }

    var initOrgBox01 = function (data) {
        var html = template('tpl-orgBox01', data);
        document.getElementById('orgBox01').innerHTML = html;
    }
    var initOrgBox02 = function (data) {
        var html = template('tpl-orgBox02', data);
        document.getElementById('orgBox02').innerHTML = html;
    }
    var initOrgBox03 = function (data) {
        var html = template('tpl-orgBox03', data);
        document.getElementById('orgBox03').innerHTML = html;
    }

    var initOrgBoxLeft = function (zhbzhzList,zhbfzhzList) {
        console.log(zhbzhzList);
        console.log(zhbfzhzList);
        var html = template('tpl-orgBoxLeft', {
            zhbzhzList: zhbzhzList,
            zhbfzhzList:zhbfzhzList
        });
        document.getElementById('orgBoxLeft').innerHTML = html;
    }

    function jgOnclick(jgId, jgName, jgType,jgOrHy) {

        if(jgOrHy=='1'){
            send(jgId,jgName);
        }
        if(jgType=='2'&&jgOrHy=='1'){
            window.location = 'index_second.html?jgId='+jgId;
        }

    }

    function toTree(data) {
        // 删除 所有 children,以防止多次调用
        data.forEach(function (item) {
            delete item.children;
        });

        // 将数据存储为 以 id 为 KEY 的 map 索引数据列
        var map = {};
        data.forEach(function (item) {
            map[item.jgid] = item;
        });
        var val = [];
        data.forEach(function (item) {
            // 以当前遍历项，的parentid,去map对象中找到索引的id
            var parent = map[item.parentid];
            // 好绕啊，如果找到索引，那么说明此项不在顶级当中,那么需要把此项添加到，他对应的父级中
            if (parent) {
                (parent.children || (parent.children = [])).push(item);
            } else {
                //如果没有在map中找到对应的索引ID,那么直接把 当前的item添加到 val结果集中，作为顶级
                val.push(item);
            }
        });
        return val;
    }


    var initBranchInfo = function () {//初始化机构数据
    }
    function send(jgId, jgName){
        var param = {};
        param.jgId = jgId;
        param.jgName = jgName;
        sendSock(param, function(e){
            console.log(e);
        });
    }
    $(document).ready(function () {
     /*   var data = [
            {jgid: 1, jgmc: "经开区", parentid: 0},
            {jgid: 2, jgmc: "昆明街道", parentid: 1},
            {jgid: 3, jgmc: "阿拉街道", parentid: 1},
            {jgid: 9, jgmc: "行业领域", parentid: 1},
            {jgid: 10, jgmc: "菜单设置", parentid: 9},
            {jgid: 4, jgmc: "请假记录", parentid: 2},
            {jgid: 5, jgmc: "系统设置", parentid: 2},
            {jgid: 6, jgmc: "权限管理", parentid: 2},
            {jgid: 7, jgmc: "用户角色", parentid: 3},
            {jgid: 8, jgmc: "菜单设置", parentid: 3},
        ];*/
        $.axget("/api/yndp/glgz/getAllJg", function (res) {
            var treeData = toTree(res.data)
            console.log(treeData)

            var zhbzhz = treeData[0].zhbzhz;
            var zhbfzhz = treeData[0].zhbfzhz;
            var zhbzhzList = zhbzhz.trim().split(/\s+/);
            var zhbfzhzList = zhbfzhz.trim().split(/\s+/);
            initOrgBoxLeft(zhbzhzList,zhbfzhzList);
            for (var i = 0; i < treeData[0].children.length; i++) {
                if (treeData[0].children[i].jgmc === "阿拉街道") {
                    initOrgBox01(treeData[0].children[i])
                } else if (treeData[0].children[i].jgmc === "洛羊街道") {
                    initOrgBox02(treeData[0].children[i])
                } else if (treeData[0].children[i].jgmc === "行业领域") {
                    initOrgBox03(treeData[0].children[i])
                    continue
                }
            }
        });





        initTitle()

        initBranchInfo()
        initWebSocket(1)
    });
</script>
</body>
</html>
