<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
    <script src="./static/js/jquery-3.4.1.min.js"></script>
    <script src="./static/js/jquery.ajax.js"></script>
    <link rel="stylesheet" href="https://a.amap.com/jsapi_demos/static/demo-center/css/demo-center.css" />

    <!-- 加载地图JSAPI脚本 -->
    <script src="https://webapi.amap.com/maps?v=1.4.15&key=189c4b430b57cb029c23124d75a88a03"></script>
    <script src="https://webapi.amap.com/maps?v=1.4.15&key=189c4b430b57cb029c23124d75a88a03"></script>
    <script src="https://a.amap.com/jsapi_demos/static/demo-center/js/demoutils.js"></script>
    <script type="text/javascript" src="src/js/coordtransform.js"></script>


    <title>地图显示</title>
    <style>
        html,
        body,
        #container {
          width: 100%;
          height: 100%;
        }
    </style>
</head>
<body>
<div id="container"></div>

<script>
   /* var geojson = "./static/geojson.json";*/
   var infoWindow = new AMap.InfoWindow({offset: new AMap.Pixel(0, -30)});
    var map = new AMap.Map('container', {
        resizeEnable: true, //是否监控地图容器尺寸变化
        zoom:13, //初始化地图层级
        center: [102.839284,24.969013] //初始化地图中心点
    });

    var styleName = "amap://styles/" + "darkblue";
     map.setMapStyle(styleName);
    ajax('http://localhost:8000/static/geojson.json', function(err, geoJSON) {
        if (!err) {
            var geojson = new AMap.GeoJSON({
                geoJSON: geoJSON,
                // 还可以自定义getMarker和getPolyline
                getPolygon: function(geojson, lnglats) {
                    // 计算面积
                    var area = AMap.GeometryUtil.ringArea(lnglats[0])

                    return new AMap.Polygon({
                        path: lnglats,
                        fillOpacity: 1 - Math.sqrt(area / 1000000000),// 面积越大透明度越高
                        strokeColor: 'white',
                        fillColor: ''
                    });
                }
            });

            geojson.setMap(map);

            log.success('GeoJSON 数据加载完成')
        } else {
            log.error('GeoJSON 服务请求失败')
         }
    })
   $(document).ready(function () {
       $.axget("/api/yndp/xxxx/getXxjw?name="+'', function (res) {
           console.log(res.data)
           for (var i = 0; i < res.data.length; i++) {
               var wgs84togcj02 = coordtransform.wgs84togcj02(res.data[i].longitude, res.data[i].latitude);
               // 构造点标记

                   var marker = new AMap.Marker({
                       icon: "https://webapi.amap.com/theme/v1.3/markers/n/mark_b.png",
                       /*position: [res.data[i].longitude, res.data[i].latitude]*/
                       position: wgs84togcj02
                   });
                   map.add(marker);
                   marker.content =  "<div  style=''>"+res.data[i].name+ '@'+res.data[i].longitude+ '@'+res.data[i].latitude+"</div>";
                   marker.on('click', markerClick);
                marker.emit('click', {target: marker});

           }
       });
   });

   function markerClick(e) {
       infoWindow.setContent(e.target.content);
       infoWindow.open(map, e.target.getPosition());
   }

   function sayHello(longitude,latitude) {
       var wgs84togcj02 = coordtransform.wgs84togcj02(longitude, latitude);
       var marker = new AMap.Marker({
           icon: "https://webapi.amap.com/theme/v1.3/markers/n/mark_b.png",
           position: [longitude, latitude]
          /* position: wgs84togcj02*/
       });
 /*      map.add(marker);*/
       marker.content =  "<div  style=''>"+123+ '@'+longitude+ '@'+latitude+"</div>";
       marker.on('click', markerClick);
       marker.emit('click', {target: marker});
   }

</script>

</body>
</html>